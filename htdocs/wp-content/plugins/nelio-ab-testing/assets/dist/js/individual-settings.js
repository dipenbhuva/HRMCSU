(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";e.r(t),e.d(t,{initField:()=>H});var n={};e.r(n),e.d(n,{getAttributes:()=>u,getValue:()=>c});var o={};e.r(o),e.d(o,{setAttributes:()=>m,setValue:()=>d});const r=window.wp.element,a=window.wp.data;var i="nab/individual-settings",l={values:{},attributes:{}},s=function(){return s=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},s.apply(this,arguments)};function c(e,t){return e.values[t]}function u(e,t){return e.attributes[t]}function d(e,t){return{type:"SET_FIELD_VALUE",field:e,value:t}}function m(e,t){return{type:"SET_FIELD_ATTRIBUTES",field:e,attributes:t}}(0,a.registerStore)(i,{reducer:function(e,t){var n;return void 0===e&&(e=l),null!==(n=function(e,t){var n,o;switch(t.type){case"SET_FIELD_VALUE":return s(s({},e),{values:s(s({},e.values),(n={},n[t.field]=t.value,n))});case"SET_FIELD_ATTRIBUTES":return s(s({},e),{attributes:s(s({},e.attributes),(o={},o[t.field]=s(s({},e.attributes[t.field]),t.attributes),o))})}}(e,t))&&void 0!==n?n:e},controls:a.controls,actions:o,selectors:n});const g=window.wp.apiFetch;var f=e.n(g);const p=window.wp.components,b=window.wp.i18n,v=window.wp.notices,h=window.React;function y(e){return e.startsWith("{{/")?{type:"componentClose",value:e.replace(/\W/g,"")}:e.endsWith("/}}")?{type:"componentSelfClosing",value:e.replace(/\W/g,"")}:e.startsWith("{{")?{type:"componentOpen",value:e.replace(/\W/g,"")}:{type:"string",value:e}}function E(e,t){let n,o,r=[];for(let a=0;a<e.length;a++){const i=e[a];if("string"!==i.type){if(void 0===t[i.value])throw new Error(`Invalid interpolation, missing component node: \`${i.value}\``);if("object"!=typeof t[i.value])throw new Error(`Invalid interpolation, component node must be a ReactElement or null: \`${i.value}\``);if("componentClose"===i.type)throw new Error(`Missing opening component token: \`${i.value}\``);if("componentOpen"===i.type){n=t[i.value],o=a;break}r.push(t[i.value])}else r.push(i.value)}if(n){const a=function(e,t){const n=t[e];let o=0;for(let r=e+1;r<t.length;r++){const e=t[r];if(e.value===n.value){if("componentOpen"===e.type){o++;continue}if("componentClose"===e.type){if(0===o)return r;o--}}}throw new Error("Missing closing component token `"+n.value+"`")}(o,e),i=E(e.slice(o+1,a),t),l=(0,h.cloneElement)(n,{},i);if(r.push(l),a<e.length-1){const n=E(e.slice(a+1),t);r=r.concat(n)}}return r=r.filter(Boolean),0===r.length?null:1===r.length?r[0]:(0,h.createElement)(h.Fragment,null,...r)}function w(e){const{mixedString:t,components:n,throwErrors:o}=e;if(!n)return t;if("object"!=typeof n){if(o)throw new Error(`Interpolation Error: unable to process \`${t}\` because components is not an object`);return t}const r=function(e){return e.split(/(\{\{\/?\s*\w+\s*\/?\}\})/g).map(y)}(t);try{return E(r,n)}catch(e){if(o)throw new Error(`Interpolation Error: unable to process \`${t}\` because of error \`${e.message}\``);return t}}const _=window.lodash,x=window.nab.components,S=window.nab.data;var N,C=new Uint8Array(16);function D(){if(!N&&!(N="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return N(C)}const k=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var T=[],O=0;O<256;++O)T.push((O+256).toString(16).substr(1));const V=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(T[e[t+0]]+T[e[t+1]]+T[e[t+2]]+T[e[t+3]]+"-"+T[e[t+4]]+T[e[t+5]]+"-"+T[e[t+6]]+T[e[t+7]]+"-"+T[e[t+8]]+T[e[t+9]]+"-"+T[e[t+10]]+T[e[t+11]]+T[e[t+12]]+T[e[t+13]]+T[e[t+14]]+T[e[t+15]]).toLowerCase();if(!function(e){return"string"==typeof e&&k.test(e)}(n))throw TypeError("Stringified UUID is invalid");return n},A=function(e,t,n){var o=(e=e||{}).random||(e.rng||D)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return V(o)};var R=function(){return R=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},R.apply(this,arguments)};function I(e,t){var n=(0,a.useSelect)((function(t){return t(i).getAttributes(e)})),o=(0,a.useDispatch)(i).setAttributes;return[R(R({},t),n),function(t){return o(e,t)}]}var F,M={mode:"disabled",isCheckingStatus:!1,value:"",domain:"",domainStatus:"disabled",dnsValidation:{}},P=null!==(F=null===v.store||void 0===v.store?void 0:v.store.name)&&void 0!==F?F:"core/notices",j=function(e){var t=e.name,n=I(t,M),o=n[0],a=n[1],i=o.mode,l=o.value;return"disabled"===i?r.createElement("input",{type:"hidden",name:"nelio-ab-testing_settings[cloud_proxy_setting]",value:JSON.stringify(o)}):"rest"===i?r.createElement("div",{className:"nab-cloud-proxy-setting__detail"},r.createElement(p.TextControl,{className:"nab-cloud-proxy-setting__detail-value",label:(0,b._x)("WordPress REST API Endpoint","text","nelio-ab-testing"),placeholder:(0,b._x)("/namespace/route","text","nelio-ab-testing"),value:l,onChange:function(e){return function(e){return a({value:e})}((0,_.trim)(e))},help:/^\/[a-z0-9-]+\/[a-z0-9-]+$/.test(l)?void 0:(0,b._x)("Please write a valid endpoint (/namespace/route)","user","nelio-ab-testing")}),r.createElement("input",{type:"hidden",name:"nelio-ab-testing_settings[cloud_proxy_setting]",value:JSON.stringify(o)})):r.createElement(B,{name:t})},B=function(e){var t=I(e.name,M),n=t[0],o=t[1],i=(0,r.useState)(!1),l=i[0],s=i[1],c=(0,r.useState)(!1),u=c[0],d=c[1],m=function(e){return o({domainStatus:e})},g=function(e){return o({isCheckingStatus:e})},v=n.mode,h=n.isCheckingStatus,y=n.domain,E=n.domainStatus,w=n.dnsValidation,_=z(y,E,w),S=U(E,w,h&&!l),N=J(),C=Y(),D=(0,a.useDispatch)(P).removeNotice;if("domain-forwarding"!==v)return null;var k=["cert-validation-pending","cert-validation-success","success"].includes(E);return r.createElement("div",{className:"nab-cloud-proxy-setting__detail"},r.createElement(p.BaseControl,{id:"nab-cloud-domain-forwarder",className:"nab-cloud-proxy-setting__detail-domain",label:r.createElement(r.Fragment,null,(0,b._x)("Custom Forwarding Domain","text","nelio-ab-testing"),"success"===E?r.createElement(p.Dashicon,{icon:"yes-alt"}):r.createElement(p.Dashicon,{icon:"warning"})),help:_},r.createElement(p.TextControl,{placeholder:(0,b._x)("forwarder.yourdomain.com","text","nelio-ab-testing"),name:"nelio-ab-testing_settings[cloud_domain_forwarder]",disabled:h||k,value:y,onChange:function(e){return o({mode:"domain-forwarding",domain:e})}}),"success"!==E&&r.createElement(p.Button,{className:"nab-cloud-proxy-setting__detail-checker",variant:"secondary",disabled:h||!L(y),isBusy:h&&!l,onClick:function(){g(!0),f()({path:"/nab/v1/domain/check",method:"POST",data:{domain:y,domainStatus:E}}).then((function(e){var t;m(e.status),"cert-validation-pending"===e.status&&(t={recordName:e.recordName||"",recordValue:e.recordValue||""},o({dnsValidation:t})),g(!1),e.status!==E&&"success"===e.status&&W()})).catch((function(e){N(e.message),g(!1)}))}},S),k&&r.createElement(r.Fragment,null,r.createElement(p.Button,{className:"nab-cloud-proxy-setting__detail-reset",isDestructive:!0,disabled:h,isBusy:h&&l,onClick:function(){return d(!0)}},(0,b._x)("Disable","text","nelio-ab-testing")),r.createElement(x.ConfirmationDialog,{title:(0,b._x)("Disable Domain Forwarding?","text","nelio-ab-testing"),text:(0,b._x)("This action will remove the domain forwarding configuration in our servers. You will need to start the process from the beginning to set up domain forwarding again. Do you want to continue?","user","nelio-ab-testing"),confirmLabel:(0,b._x)("Continue","command","nelio-ab-testing"),cancelLabel:(0,b._x)("Back","command","nelio-ab-testing"),isDestructive:!0,onCancel:function(){return d(!1)},onConfirm:function(){d(!1),g(!0),s(!0),f()({path:"/nab/v1/domain/reset",method:"POST"}).then((function(){m("disabled")})).catch((function(e){N(e.message)})).finally((function(){g(!1),s(!1),W()}))},isOpen:u}))),"cert-validation-pending"===E&&!!w.recordName&&!!w.recordValue&&r.createElement($,{domain:y,recordName:w.recordName,recordValue:w.recordValue}),r.createElement("input",{type:"hidden",name:"nelio-ab-testing_settings[cloud_proxy_setting]",value:JSON.stringify(n)}),r.createElement(p.NoticeList,{className:"nab-cloud-proxy-setting__detail-errors",notices:C,onRemove:D}))},$=function(e){var t=e.domain,n=e.recordName,o=e.recordValue;return r.createElement("table",{className:"nab-cloud-proxy-setting__detail-dns-record"},r.createElement("thead",null,r.createElement("tr",null,r.createElement("th",null,(0,b._x)("Domain Name","text","nelio-ab-testing")),r.createElement("th",null,(0,b._x)("Record Name","text","nelio-ab-testing")),r.createElement("th",null,(0,b._x)("Record Type","text","nelio-ab-testing")),r.createElement("th",null,(0,b._x)("Record Value","text","nelio-ab-testing")))),r.createElement("tbody",null,r.createElement("tr",null,r.createElement("td",null,t),r.createElement("td",null,n),r.createElement("td",null,"CNAME"),r.createElement("td",null,o))))},L=function(e){return/^[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,6}$/i.test(e)},W=function(){var e;null===(e=document.getElementById("submit"))||void 0===e||e.click()},U=function(e,t,n){switch(e){case"disabled":case"missing-forward":case"cert-validation-success":return n?(0,b._x)("Checking…","command","nelio-ab-testing"):(0,b._x)("Check","command","nelio-ab-testing");case"cert-validation-pending":return t.recordName&&t.recordValue?n?(0,b._x)("Validating…","command","nelio-ab-testing"):(0,b._x)("Validate","command","nelio-ab-testing"):n?(0,b._x)("Refreshing…","command","nelio-ab-testing"):(0,b._x)("Refresh","command","nelio-ab-testing");case"success":return(0,b._x)("Disable","text","nelio-ab-testing")}},z=function(e,t,n){switch(t){case"disabled":return(0,b._x)("Domain forwarding disabled","text","nelio-ab-testing");case"missing-forward":return w({mixedString:(0,b.sprintf)(/* translators: domain */
(0,b._x)("{{strong}}Step 1 of 3:{{/strong}} To configure domain forwarding for %1$s, please add a CNAME record in your DNS configuration for %1$s and set the destination or target to {{code}}api.nelioabtesting.com{{/code}}. If you are not familiar with CNAME records, contact your domain host, who can help you. Once created, {{strong}}check again{{/strong}}. Note that the propagation of DNS records may take some time.","user","nelio-ab-testing"),"{{code}}".concat(e,"{{/code}}"),"{{code}}".concat(e,"{{/code}}")),components:{code:r.createElement("code",null),strong:r.createElement("strong",null)}});case"cert-validation-pending":return n.recordName&&n.recordValue?w({mixedString:(0,b._x)("Your domain is CNAMED correctly to our servers.{{break}}{{/break}}{{strong}}Step 2 of 3:{{/strong}} To validate the ownership of your domain, create the following DNS record:","user","nelio-ab-testing"),components:{break:r.createElement("br",null),strong:r.createElement("strong",null)}}):w({mixedString:(0,b._x)("Your domain is CNAMED correctly to our servers.{{break}}{{/break}}{{strong}}Step 2 of 3:{{/strong}} Now we need to validate that you are the owner of your domain by creating an additional DNS record. Click on the {{strong}}Refresh{{/strong}} button to get the details about the DNS record that you need to create.","user","nelio-ab-testing"),components:{break:r.createElement("br",null),strong:r.createElement("strong",null)}});case"cert-validation-success":return w({mixedString:(0,b._x)("Your domain is CNAMED correctly to our servers.{{break}}{{/break}}{{strong}}Step 3 of 3:{{/strong}} We are configuring the forwarding on our end. Wait a few minutes and check again.","user","nelio-ab-testing"),components:{break:r.createElement("br",null),strong:r.createElement("strong",null)}});case"success":return(0,b._x)("Domain forwarding successfully configured","text","nelio-ab-testing")}},J=function(){var e=(0,a.useDispatch)(P),t=e.createErrorNotice,n=e.removeNotice,o=(0,b._x)("Unknown error while checking domain forwarding status.","text","nelio-ab-testing");return function(e){var r=A();t(e||o,{id:r,onDismiss:function(){return n(r)}})}},Y=function(){return(0,a.useSelect)((function(e){return e(P).getNotices()}))},G={name:"",value:"",_placeholder:""},q={CloudProxySetting:function(e){var t,n=e.name,o=I(n,M),i=o[0],l=o[1],s=(t=(0,a.useSelect)((function(e){return e(S.STORE_NAME).isSubscribedTo("enterprise")})),[{value:"disabled",label:(0,b._x)("Disabled","text (proxy)","nelio-ab-testing")},{value:"rest",label:(0,b._x)("REST API","command","nelio-ab-testing")},{disabled:!t,value:"domain-forwarding",label:t?(0,b._x)("Domain Forwarding","text (proxy)","nelio-ab-testing"):(0,b._x)("Domain Forwarding (enterprise only)","text (proxy)","nelio-ab-testing")}]),c=i.mode;return r.createElement(r.Fragment,null,r.createElement(p.SelectControl,{className:"nab-cloud-proxy-setting__selector",options:s,value:c,onChange:function(e){return l({mode:e})}}),r.createElement(j,{name:n}))},GdprCookieSetting:function(e){var t=e.name,n=I(t,G),o=n[0],a=n[1],i=o.name,l=o.value,s=o._placeholder;return r.createElement("div",{className:"nab-gdpr-cookie-setting"},r.createElement(p.TextControl,{value:i,onChange:function(e){return a({name:e})},placeholder:s||(0,b._x)("Cookie Name","text","nelio-ab-testing")}),!!i&&r.createElement(p.TextControl,{value:l,onChange:function(e){return a({value:e})},placeholder:(0,b._x)("Optional Cookie Value","text","nelio-ab-testing")}),r.createElement("input",{type:"hidden",name:t,value:JSON.stringify({name:i,value:l})}))}};function H(e,t){var n=t.component,o=q[n];if(o){var l=document.getElementById(e);if(l){var s=t.name,c=t.value,u=t.attributes,d=(0,a.dispatch)(i),m=d.setValue,g=d.setAttributes;m(s,c),g(s,u),(0,r.render)(r.createElement(o,{name:s}),l)}}}})();var n=nab="undefined"==typeof nab?{}:nab;for(var o in t)n[o]=t[o];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();